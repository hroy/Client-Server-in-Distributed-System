import java.io.ObjectInputStream;
import java.io.ObjectOutputStream;
import java.net.Socket;


public class WorkerThread implements Runnable
{
	Socket socket;
	PortalServant portalServant;
	
	public WorkerThread(Socket socket, PortalServant portalServant)
	{
		this.socket = socket;
		this.portalServant = portalServant;
	}

	@Override
	public void run()
	{
		try
		{
			ObjectInputStream objectInputStream = new ObjectInputStream(socket.getInputStream());
			ObjectOutputStream objectOutputStream = new ObjectOutputStream(socket.getOutputStream());
			
			Object object = objectInputStream.readObject();
			RemoteObject remoteObject = (RemoteObject)object;
			
			System.out.println("Reqest recieved ObjectId: " + remoteObject.getObjectId());
			System.out.println("MethodName: " + remoteObject.getMethodName());
			System.out.println("Parameter: " + remoteObject.getParameter());
			
			Object localObject = RemoteRefModule.getObject(remoteObject.getObjectId());
			
			Object returnObject = null;
			
			if(localObject instanceof PortalServant)
			{
				PortalServantSkeleton portalServantSkeleton = new PortalServantSkeleton(remoteObject, (PortalServant)localObject);
				returnObject = portalServantSkeleton.unmarshall();
			}
			else if(localObject instanceof Account)
			{
				AccountSkeleton accountSkeleton = new AccountSkeleton(remoteObject, (Account)localObject);
				returnObject = accountSkeleton.unmarshall();

				portalServant.saveState();
			}
			
			System.out.println("");
			
			objectOutputStream.writeObject(returnObject);
			
			objectOutputStream.close();
			objectInputStream.close();
			socket.close();
			
		}
		catch(Exception ex)
		{
			System.out.println("WorkerThread.run() -> " + ex.toString());
		}
	}
	
}
